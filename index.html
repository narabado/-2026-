<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>2026 奈良バドミントン新年団体戦 オンラインエントリー</title>
  <style>
    body { font-family: sans-serif; margin: 2em; }
    .section { margin-bottom: 2em; }
    .status-box { display: flex; flex-wrap: wrap; gap: 1em; }
    .status-item { border: 1px solid #ccc; padding: 1em; width: 150px; text-align: center; }
    .button { padding: 0.5em 1em; background: #007bff; color: white; border: none; cursor: pointer; }
    .button:hover { background: #0056b3; }
    .message { margin-top: 1em; font-weight: bold; }
  </style>
</head>
<body>
  <h1>2026 奈良バドミントン新年団体戦 オンラインエントリー</h1>

  <div class="section">
    <h2>チーム登録</h2>
    <form id="entryForm">
      <label>チーム名: <input type="text" name="team_name" required></label><br><br>
      <label>ランク:
        <select name="team_rank">
          <option value="A">Aランク</option>
          <option value="B">Bランク</option>
          <option value="C">Cランク</option>
          <option value="D">Dランク</option>
        </select>
      </label><br><br>
      <button type="submit" class="button">登録</button>
    </form>
    <div id="formMessage" class="message"></div>
  </div>

  <div class="section">
    <h2>現在の登録状況</h2>
    <div class="status-box" id="statusBox">
      <div class="status-item">登録チーム数<br><span id="teamCount">0</span></div>
      <div class="status-item">総選手数<br><span id="playerCount">0</span></div>
      <div class="status-item">男性<br><span id="maleCount">0</span></div>
      <div class="status-item">女性<br><span id="femaleCount">0</span></div>
      <div class="status-item">Aランク<br><span id="rankA">0</span></div>
      <div class="status-item">Bランク<br><span id="rankB">0</span></div>
      <div class="status-item">Cランク<br><span id="rankC">0</span></div>
      <div class="status-item">Dランク<br><span id="rankD">0</span></div>
    </div>
    <br>
    <button class="button" onclick="loadEntries()">最新情報に更新</button>
  </div>

  <script>
    document.getElementById("entryForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const form = e.target;
      const data = {
        team_name: form.team_name.value,
        team_rank: form.team_rank.value
      };

      google.script.run
        .withSuccessHandler(function(result) {
          if (result.success) {
            document.getElementById("formMessage").textContent = "登録が完了しました！";
            form.reset();
            loadEntries();
          } else {
            document.getElementById("formMessage").textContent = "登録に失敗しました: " + (result.error || "不明なエラー");
          }
        })
        .withFailureHandler(function(error) {
          document.getElementById("formMessage").textContent = "通信エラー: " + error.message;
        })
        .addEntry(data);
    });

    function loadEntries() {
      google.script.run
        .withSuccessHandler(function(result) {
          const items = result.items || [];
          document.getElementById("teamCount").textContent = items.length;
          document.getElementById("playerCount").textContent = items.length;

          let male = 0, female = 0, rankA = 0, rankB = 0, rankC = 0, rankD = 0;
          items.forEach(item => {
            if (item.gender === "男") male++;
            if (item.gender === "女") female++;
            if (item.team_rank === "A") rankA++;
            if (item.team_rank === "B") rankB++;
            if (item.team_rank === "C") rankC++;
            if (item.team_rank === "D") rankD++;
          });

          document.getElementById("maleCount").textContent = male;
          document.getElementById("femaleCount").textContent = female;
          document.getElementById("rankA").textContent = rankA;
          document.getElementById("rankB").textContent = rankB;
          document.getElementById("rankC").textContent = rankC;
          document.getElementById("rankD").textContent = rankD;
        })
        .withFailureHandler(function(error) {
          alert("登録状況の取得に失敗しました: " + error.message);
        })
        .getEntries({ limit: 1000, offset: 0 });
    }

    window.onload = loadEntries;
  </script>
</body>
</html>
