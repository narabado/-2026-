<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>2026 å¥ˆè‰¯ãƒãƒ‰ãƒŸãƒ³ãƒˆãƒ³æ–°å¹´å›£ä½“æˆ¦ ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚¨ãƒ³ãƒˆãƒªãƒ¼</title>
  <style>
    /* =================================
       ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ»ãƒ™ãƒ¼ã‚¹
       ================================= */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', 'Yu Gothic', 'Hiragino Sans', sans-serif;
      background: linear-gradient(135deg, #fffbe0, #ffedac);
      min-height: 100vh;
      padding: 20px;
    }

    h1 {
      text-align: center;
      color: #d35400;
      margin-bottom: 20px;
      font-size: 1.8rem;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.15);
    }

    /* =================================
       ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆã‚¹ã‚¿ã‚¤ãƒ«
       ================================= */
    .tabs {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .tab-button {
      padding: 12px 24px;
      background-color: #fff;
      border: 2px solid #d35400;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: bold;
      color: #d35400;
      transition: all 0.3s;
    }

    .tab-button:hover {
      background-color: #ffe5cc;
    }

    .tab-button.active {
      background-color: #d35400;
      color: #fff;
    }

    /* =================================
       ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å…±é€š
       ================================= */
    .tab-content {
      display: none;
      background-color: #fff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
      max-width: 900px;
      margin: 0 auto;
    }

    .tab-content.active {
      display: block;
    }

    .section {
      margin-bottom: 30px;
    }

    .section h2 {
      font-size: 1.3rem;
      color: #c0392b;
      border-bottom: 2px solid #d35400;
      padding-bottom: 8px;
      margin-bottom: 16px;
    }

    /* =================================
       ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ 
       ================================= */
    label {
      display: inline-block;
      font-weight: 600;
      color: #333;
      margin-bottom: 6px;
    }

    input[type="text"],
    input[type="email"],
    input[type="tel"],
    select {
      width: 100%;
      padding: 10px;
      font-size: 1rem;
      border: 1px solid #bbb;
      border-radius: 6px;
      background-color: #fafafa;
      transition: border-color 0.2s;
    }

    input:focus, select:focus {
      outline: none;
      border-color: #d35400;
      background-color: #fff;
    }

    .form-row {
      display: flex;
      gap: 12px;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }

    .form-col {
      flex: 1;
      min-width: 200px;
    }

    /* =================================
       é¸æ‰‹ã‚«ãƒ¼ãƒ‰
       ================================= */
    .player-card {
      border: 2px solid #d35400;
      border-radius: 10px;
      padding: 16px;
      margin-bottom: 16px;
      background-color: #fffaeb;
    }

    .player-card h3 {
      font-size: 1.1rem;
      color: #c0392b;
      margin-bottom: 12px;
    }

    /* =================================
       ãƒœã‚¿ãƒ³
       ================================= */
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      margin-top: 16px;
    }

    .btn-primary {
      background-color: #d35400;
      color: #fff;
    }

    .btn-primary:hover {
      background-color: #a04200;
    }

    .btn-secondary {
      background-color: #3498db;
      color: #fff;
    }

    .btn-secondary:hover {
      background-color: #2c81ba;
    }

    .btn-danger {
      background-color: #e74c3c;
      color: #fff;
      padding: 8px 16px;
      font-size: 0.9rem;
    }

    .btn-danger:hover {
      background-color: #c0392b;
    }

    .btn-warning {
      background-color: #f39c12;
      color: #fff;
      padding: 8px 16px;
      font-size: 0.9rem;
    }

    .btn-warning:hover {
      background-color: #d68910;
    }

    /* =================================
       ç™»éŒ²çŠ¶æ³ã‚¿ãƒ–
       ================================= */
    .stats-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 20px;
    }

    .stat-box {
      background-color: #fffaeb;
      border: 2px solid #d35400;
      border-radius: 10px;
      padding: 16px;
      text-align: center;
    }

    .stat-box h3 {
      font-size: 1rem;
      color: #c0392b;
      margin-bottom: 8px;
    }

    .stat-box p {
      font-size: 2rem;
      font-weight: bold;
      color: #d35400;
    }

    /* =================================
       ç®¡ç†ã‚¿ãƒ–
       ================================= */
    #adminLoginArea {
      text-align: center;
      padding: 40px 20px;
    }

    #adminContent {
      display: none;
    }

    #adminTable {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      overflow-x: auto;
      display: block;
    }

    #adminTable th,
    #adminTable td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: left;
      font-size: 0.9rem;
    }

    #adminTable th {
      background-color: #d35400;
      color: #fff;
      font-weight: bold;
      position: sticky;
      top: 0;
    }

    #adminTable tr:nth-child(even) {
      background-color: #fffaeb;
    }

    #adminTable tr:hover {
      background-color: #ffe5cc;
    }

    .deleted-row {
      background-color: #ffcccc !important;
      opacity: 0.7;
    }

    /* =================================
       ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ»ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
       ================================= */
    .message {
      padding: 12px;
      border-radius: 8px;
      margin-top: 16px;
      font-weight: 600;
    }

    .message.success {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .message.error {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    /* =================================
       ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
       ================================= */
    .loading {
      display: none;
      text-align: center;
      padding: 20px;
      color: #d35400;
      font-weight: bold;
    }

    .loading.active {
      display: block;
    }

    /* =================================
       ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–èª¿æ•´
       ================================= */
    @media (max-width: 768px) {
      h1 {
        font-size: 1.5rem;
      }

      .tab-button {
        padding: 10px 16px;
        font-size: 0.9rem;
      }

      .tab-content {
        padding: 20px;
      }

      .form-row {
        flex-direction: column;
      }

      .stat-box p {
        font-size: 1.5rem;
      }
    }
  </style>
</head>
<body>

  <h1>ğŸ¸ 2026 å¥ˆè‰¯ãƒãƒ‰ãƒŸãƒ³ãƒˆãƒ³æ–°å¹´å›£ä½“æˆ¦ ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚¨ãƒ³ãƒˆãƒªãƒ¼</h1>

  <!-- ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ -->
  <div class="tabs">
    <button class="tab-button active" onclick="switchTab('registration')">ãƒãƒ¼ãƒ ç™»éŒ²</button>
    <button class="tab-button" onclick="switchTab('status')">ç™»éŒ²çŠ¶æ³</button>
    <button class="tab-button" onclick="switchTab('admin')">ç®¡ç†</button>
  </div>

  <!-- ========================================
       ã‚¿ãƒ–1: ãƒãƒ¼ãƒ ç™»éŒ²
       ======================================== -->
  <div id="registration" class="tab-content active">
    <form id="entryForm">
      
      <!-- ç”³è¾¼è€…æƒ…å ± -->
      <div class="section">
        <h2>ç”³è¾¼è€…æƒ…å ±</h2>
        <div class="form-row">
          <div class="form-col">
            <label>æ°å <span style="color:red;">*</span></label>
            <input type="text" id="applicant_name" name="applicant_name" required>
          </div>
          <div class="form-col">
            <label>ãƒ•ãƒªã‚¬ãƒŠ <span style="color:red;">*</span></label>
            <input type="text" id="applicant_kana" name="applicant_kana" required>
          </div>
        </div>
        <div class="form-row">
          <div class="form-col">
            <label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ <span style="color:red;">*</span></label>
            <input type="email" id="applicant_email" name="applicant_email" required>
          </div>
          <div class="form-col">
            <label>é›»è©±ç•ªå· <span style="color:red;">*</span></label>
            <input type="tel" id="applicant_phone" name="applicant_phone" required>
          </div>
        </div>
      </div>

      <!-- ãƒãƒ¼ãƒ æƒ…å ± -->
      <div class="section">
        <h2>ãƒãƒ¼ãƒ æƒ…å ±</h2>
        <div class="form-row">
          <div class="form-col">
            <label>ãƒãƒ¼ãƒ å <span style="color:red;">*</span></label>
            <input type="text" id="team_name" name="team_name" required>
          </div>
          <div class="form-col">
            <label>ãƒãƒ¼ãƒ ãƒ©ãƒ³ã‚¯ <span style="color:red;">*</span></label>
            <select id="team_rank" name="team_rank" required onchange="updateRankOptions()">
              <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
              <option value="A">Aã‚¯ãƒ©ã‚¹</option>
              <option value="B">Bã‚¯ãƒ©ã‚¹</option>
              <option value="C">Cã‚¯ãƒ©ã‚¹</option>
              <option value="D">Dã‚¯ãƒ©ã‚¹</option>
            </select>
          </div>
        </div>
      </div>

      <!-- é¸æ‰‹æƒ…å ± -->
      <div class="section">
        <h2>é¸æ‰‹æƒ…å ±ï¼ˆ4åä»¥ä¸Šå¿…é ˆã€æœ€å¤§6åï¼‰</h2>
        
        <!-- é¸æ‰‹1ã€œ6ã®ã‚«ãƒ¼ãƒ‰ -->
        <div id="playersContainer">
          <!-- JavaScriptã§å‹•çš„ç”Ÿæˆ -->
        </div>

        <p style="color:#555; margin-top:12px; font-size:0.9rem;">
          â€» Aã‚¯ãƒ©ã‚¹ã¯å¥³æ€§2åä»¥ä¸Š ã¾ãŸã¯ Bãƒ©ãƒ³ã‚¯ä»¥ä¸Šã®ç”·æ€§2åä»¥ä¸Š ãŒå¿…é ˆã§ã™<br>
          â€» 4åä»¥ä¸Šã®é¸æ‰‹ç™»éŒ²ãŒå¿…è¦ã§ã™
        </p>
      </div>

      <!-- é€ä¿¡ãƒœã‚¿ãƒ³ -->
      <button type="submit" class="btn btn-primary">ç™»éŒ²ã™ã‚‹</button>
      
      <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º -->
      <div id="formLoading" class="loading">é€ä¿¡ä¸­...</div>
      
      <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
      <div id="formMessage"></div>
    </form>
  </div>

  <!-- ========================================
       ã‚¿ãƒ–2: ç™»éŒ²çŠ¶æ³
       ======================================== -->
  <div id="status" class="tab-content">
    <h2>ç¾åœ¨ã®ç™»éŒ²çŠ¶æ³</h2>
    
    <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º -->
    <div id="statusLoading" class="loading">èª­ã¿è¾¼ã¿ä¸­...</div>
    
    <!-- çµ±è¨ˆè¡¨ç¤º -->
    <div class="stats-container" id="statsContainer">
      <!-- JavaScriptã§å‹•çš„ç”Ÿæˆ -->
    </div>

    <button class="btn btn-secondary" onclick="loadEntries()">æœ€æ–°æƒ…å ±ã«æ›´æ–°</button>
  </div>

  <!-- ========================================
       ã‚¿ãƒ–3: ç®¡ç†
       ======================================== -->
  <div id="admin" class="tab-content">
    
    <!-- ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒªã‚¢ -->
    <div id="adminLoginArea">
      <h2>ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³</h2>
      <div style="max-width:400px; margin:20px auto;">
        <label>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
        <input type="password" id="adminPassword" style="width:100%; margin-bottom:12px;">
        <button class="btn btn-secondary" onclick="adminLogin()">ãƒ­ã‚°ã‚¤ãƒ³</button>
      </div>
    </div>

    <!-- ãƒ­ã‚°ã‚¤ãƒ³å¾Œã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <div id="adminContent">
      <h2>å…¨ç™»éŒ²ãƒ‡ãƒ¼ã‚¿ï¼ˆå‰Šé™¤æ¸ˆã¿å«ã‚€ï¼‰</h2>
      
      <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º -->
      <div id="adminLoading" class="loading">èª­ã¿è¾¼ã¿ä¸­...</div>
      
      <button class="btn btn-secondary" onclick="adminLoadAll()">ãƒ‡ãƒ¼ã‚¿å†èª­è¾¼</button>
      
      <div style="overflow-x:auto; margin-top:20px;">
        <table id="adminTable">
          <thead>
            <tr>
              <th>ID</th>
              <th>ãƒãƒ¼ãƒ å</th>
              <th>ç”³è¾¼è€…</th>
              <th>ãƒ¡ãƒ¼ãƒ«</th>
              <th>é›»è©±</th>
              <th>ãƒ©ãƒ³ã‚¯</th>
              <th>é¸æ‰‹æ•°</th>
              <th>å‰Šé™¤</th>
              <th>æ“ä½œ</th>
            </tr>
          </thead>
          <tbody id="adminTableBody">
            <!-- JavaScriptã§å‹•çš„ç”Ÿæˆ -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- ========================================
       JavaScript
       ======================================== -->
  <script>
    // ===========================================
    // å®šæ•°è¨­å®šï¼ˆé‡è¦ï¼šæ–°ã—ã„GAS URLã«æ›´æ–°ï¼‰
    // ===========================================
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw1H0Socg6u-9NNA0ys7HnEH7QArGmw22MMBgAC1E52OUxCEpbR_vmCXyEUADHD6opccw/exec';
    const ADMIN_PASSWORD = 'narabado2026';

    // ===========================================
    // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
    // ===========================================
    function switchTab(tabName) {
      // å…¨ã‚¿ãƒ–éã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('active');
      });

      // æŒ‡å®šã‚¿ãƒ–ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–
      document.getElementById(tabName).classList.add('active');
      event.target.classList.add('active');

      // ç™»éŒ²çŠ¶æ³ã‚¿ãƒ–ã‚’é–‹ã„ãŸã‚‰è‡ªå‹•æ›´æ–°
      if (tabName === 'status') {
        loadEntries();
      }
    }

    // ===========================================
    // é¸æ‰‹ã‚«ãƒ¼ãƒ‰å‹•çš„ç”Ÿæˆï¼ˆ6ååˆ†ï¼‰
    // ===========================================
    function initPlayerCards() {
      const container = document.getElementById('playersContainer');
      container.innerHTML = '';

      for (let i = 1; i <= 6; i++) {
        const card = document.createElement('div');
        card.className = 'player-card';
        card.innerHTML = `
          <h3>é¸æ‰‹${i}${i <= 4 ? ' <span style="color:red;">*å¿…é ˆ</span>' : ''}</h3>
          <div class="form-row">
            <div class="form-col">
              <label>æ°å</label>
              <input type="text" id="player${i}_name" name="player${i}_name" ${i <= 4 ? 'required' : ''}>
            </div>
            <div class="form-col">
              <label>ãƒ•ãƒªã‚¬ãƒŠ</label>
              <input type="text" id="player${i}_kana" name="player${i}_kana" ${i <= 4 ? 'required' : ''}>
            </div>
          </div>
          <div class="form-row">
            <div class="form-col">
              <label>å­¦å¹´</label>
              <select id="player${i}_grade" name="player${i}_grade" ${i <= 4 ? 'required' : ''}>
                <option value="">é¸æŠ</option>
                <option value="å°1">å°1</option>
                <option value="å°2">å°2</option>
                <option value="å°3">å°3</option>
                <option value="å°4">å°4</option>
                <option value="å°5">å°5</option>
                <option value="å°6">å°6</option>
                <option value="ä¸­1">ä¸­1</option>
                <option value="ä¸­2">ä¸­2</option>
                <option value="ä¸­3">ä¸­3</option>
                <option value="é«˜1">é«˜1</option>
                <option value="é«˜2">é«˜2</option>
                <option value="é«˜3">é«˜3</option>
                <option value="å¤§å­¦ç”Ÿ">å¤§å­¦ç”Ÿ</option>
                <option value="ç¤¾ä¼šäºº">ç¤¾ä¼šäºº</option>
              </select>
            </div>
            <div class="form-col">
              <label>æ€§åˆ¥</label>
              <select id="player${i}_gender" name="player${i}_gender" ${i <= 4 ? 'required' : ''} onchange="updateRankOptions()">
                <option value="">é¸æŠ</option>
                <option value="ç”·æ€§">ç”·æ€§</option>
                <option value="å¥³æ€§">å¥³æ€§</option>
              </select>
            </div>
            <div class="form-col">
              <label>ãƒ©ãƒ³ã‚¯</label>
              <select id="player${i}_rank" name="player${i}_rank" ${i <= 4 ? 'required' : ''}>
                <option value="">é¸æŠ</option>
              </select>
            </div>
          </div>
        `;
        container.appendChild(card);
      }
    }

    // ===========================================
    // ãƒ©ãƒ³ã‚¯é¸æŠè‚¢ã®æ›´æ–°ï¼ˆæ€§åˆ¥ã¨ãƒãƒ¼ãƒ ãƒ©ãƒ³ã‚¯ã«å¿œã˜ã¦ï¼‰
    // ===========================================
    function updateRankOptions() {
      const teamRank = document.getElementById('team_rank').value;

      for (let i = 1; i <= 6; i++) {
        const genderSelect = document.getElementById(`player${i}_gender`);
        const rankSelect = document.getElementById(`player${i}_rank`);
        
        if (!genderSelect || !rankSelect) continue;

        const gender = genderSelect.value;
        rankSelect.innerHTML = '<option value="">é¸æŠ</option>';

        if (!gender || !teamRank) continue;

        let ranks = [];
        if (gender === 'ç”·æ€§') {
          if (teamRank === 'A') ranks = ['A', 'B', 'C'];
          else if (teamRank === 'B') ranks = ['B', 'C', 'D'];
          else if (teamRank === 'C') ranks = ['C', 'D'];
          else if (teamRank === 'D') ranks = ['D'];
        } else if (gender === 'å¥³æ€§') {
          if (teamRank === 'A') ranks = ['A', 'B', 'C', 'D'];
          else if (teamRank === 'B') ranks = ['B', 'C', 'D'];
          else if (teamRank === 'C') ranks = ['C', 'D'];
          else if (teamRank === 'D') ranks = ['D'];
        }

        ranks.forEach(rank => {
          const option = document.createElement('option');
          option.value = rank;
          option.textContent = rank;
          rankSelect.appendChild(option);
        });
      }
    }

    // ===========================================
    // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å‡¦ç†
    // ===========================================
    document.getElementById('entryForm').addEventListener('submit', async function(e) {
      e.preventDefault();

      const formData = new FormData(this);
      const data = { action: 'add' };

      // ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
      formData.forEach((value, key) => {
        data[key] = value || '';
      });

      // é¸æ‰‹æ•°ã‚«ã‚¦ãƒ³ãƒˆ
      let playerCount = 0;
      for (let i = 1; i <= 6; i++) {
        if (data[`player${i}_name`]) playerCount++;
      }

      // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
      if (playerCount < 4) {
        showMessage('formMessage', 'é¸æ‰‹ã¯4åä»¥ä¸Šç™»éŒ²ã—ã¦ãã ã•ã„', 'error');
        return;
      }

      // Aã‚¯ãƒ©ã‚¹ã®è¿½åŠ ãƒã‚§ãƒƒã‚¯
      if (data.team_rank === 'A') {
        let femaleCount = 0;
        let maleBRankCount = 0;

        for (let i = 1; i <= 6; i++) {
          const gender = data[`player${i}_gender`];
          const rank = data[`player${i}_rank`];
          
          if (gender === 'å¥³æ€§' && rank) femaleCount++;
          if (gender === 'ç”·æ€§' && ['A', 'B'].includes(rank)) maleBRankCount++;
        }

        if (femaleCount < 2 && maleBRankCount < 2) {
          showMessage('formMessage', 'Aã‚¯ãƒ©ã‚¹ã¯å¥³æ€§2åä»¥ä¸Šã€ã¾ãŸã¯Bãƒ©ãƒ³ã‚¯ä»¥ä¸Šã®ç”·æ€§2åä»¥ä¸ŠãŒå¿…è¦ã§ã™', 'error');
          return;
        }
      }

      // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
      showLoading('formLoading', true);
      hideMessage('formMessage');

      // GASã¸é€ä¿¡ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ãªã—ï¼‰
      try {
        const response = await fetch(SCRIPT_URL, {
          method: 'POST',
          body: JSON.stringify(data)
        });

        const result = await response.json();

        if (result.success) {
          showMessage('formMessage', `ç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸï¼ï¼ˆID: ${result.id}ï¼‰`, 'success');
          this.reset();
          initPlayerCards();
        } else {
          showMessage('formMessage', 'ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + (result.error || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼'), 'error');
        }
      } catch (error) {
        showMessage('formMessage', 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message, 'error');
        console.error('é€ä¿¡ã‚¨ãƒ©ãƒ¼:', error);
      } finally {
        showLoading('formLoading', false);
      }
    });

    // ===========================================
    // ç™»éŒ²çŠ¶æ³ã®èª­è¾¼
    // ===========================================
    async function loadEntries() {
      showLoading('statusLoading', true);

      try {
        const response = await fetch(SCRIPT_URL, {
          method: 'POST',
          body: JSON.stringify({ action: 'get', limit: 1000, offset: 0 })
        });

        const result = await response.json();

        if (!result.items) {
          showStats({ teams: 0, players: 0, male: 0, female: 0, ranks: {} });
          return;
        }

        // çµ±è¨ˆè¨ˆç®—
        const stats = {
          teams: result.items.length,
          players: 0,
          male: 0,
          female: 0,
          ranks: { A: 0, B: 0, C: 0, D: 0 }
        };

        result.items.forEach(item => {
          for (let i = 1; i <= 6; i++) {
            const name = item[`player${i}_name`];
            const gender = item[`player${i}_gender`];
            const rank = item[`player${i}_rank`];

            if (name) {
              stats.players++;
              if (gender === 'ç”·æ€§') stats.male++;
              if (gender === 'å¥³æ€§') stats.female++;
              if (rank && stats.ranks[rank] !== undefined) {
                stats.ranks[rank]++;
              }
            }
          }
        });

        showStats(stats);
      } catch (error) {
        console.error('ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
        showStats({ teams: 0, players: 0, male: 0, female: 0, ranks: {} });
      } finally {
        showLoading('statusLoading', false);
      }
    }

    // ===========================================
    // çµ±è¨ˆè¡¨ç¤º
    // ===========================================
    function showStats(stats) {
      const container = document.getElementById('statsContainer');
      container.innerHTML = `
        <div class="stat-box">
          <h3>ç™»éŒ²ãƒãƒ¼ãƒ æ•°</h3>
          <p>${stats.teams}</p>
        </div>
        <div class="stat-box">
          <h3>ç·é¸æ‰‹æ•°</h3>
          <p>${stats.players}</p>
        </div>
        <div class="stat-box">
          <h3>ç”·æ€§</h3>
          <p>${stats.male}</p>
        </div>
        <div class="stat-box">
          <h3>å¥³æ€§</h3>
          <p>${stats.female}</p>
        </div>
        <div class="stat-box">
          <h3>Aãƒ©ãƒ³ã‚¯</h3>
          <p>${stats.ranks.A || 0}</p>
        </div>
        <div class="stat-box">
          <h3>Bãƒ©ãƒ³ã‚¯</h3>
          <p>${stats.ranks.B || 0}</p>
        </div>
        <div class="stat-box">
          <h3>Cãƒ©ãƒ³ã‚¯</h3>
          <p>${stats.ranks.C || 0}</p>
        </div>
        <div class="stat-box">
          <h3>Dãƒ©ãƒ³ã‚¯</h3>
          <p>${stats.ranks.D || 0}</p>
        </div>
      `;
    }

    // ===========================================
    // ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³
    // ===========================================
    function adminLogin() {
      const password = document.getElementById('adminPassword').value;
      if (password === ADMIN_PASSWORD) {
        document.getElementById('adminLoginArea').style.display = 'none';
        document.getElementById('adminContent').style.display = 'block';
        adminLoadAll();
      } else {
        alert('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“');
      }
    }

    // ===========================================
    // ç®¡ç†è€…ç”¨ï¼šå…¨ãƒ‡ãƒ¼ã‚¿èª­è¾¼
    // ===========================================
    async function adminLoadAll() {
      showLoading('adminLoading', true);

      try {
        const response = await fetch(SCRIPT_URL, {
          method: 'POST',
          body: JSON.stringify({ action: 'getAll' })
        });

        const result = await response.json();

        if (!result.items) {
          document.getElementById('adminTableBody').innerHTML = '<tr><td colspan="9">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>';
          return;
        }

        const tbody = document.getElementById('adminTableBody');
        tbody.innerHTML = '';

        result.items.forEach(item => {
          const isDeleted = item.delete_flag === '1' || item.delete_flag === 1;
          
          // é¸æ‰‹æ•°ã‚«ã‚¦ãƒ³ãƒˆ
          let playerCount = 0;
          for (let i = 1; i <= 6; i++) {
            if (item[`player${i}_name`]) playerCount++;
          }

          const row = document.createElement('tr');
          if (isDeleted) row.classList.add('deleted-row');

          row.innerHTML = `
            <td>${item.id || '-'}</td>
            <td>${item.team_name || '-'}</td>
            <td>${item.applicant_name || '-'}</td>
            <td>${item.applicant_email || '-'}</td>
            <td>${item.applicant_phone || '-'}</td>
            <td>${item.team_rank || '-'}</td>
            <td>${playerCount}</td>
            <td>${isDeleted ? 'å‰Šé™¤æ¸ˆã¿' : 'æœ‰åŠ¹'}</td>
            <td>
              ${!isDeleted ? `
                <button class="btn-danger" onclick="deleteEntry('${item.id}')">å‰Šé™¤</button>
              ` : `
                <button class="btn-warning" onclick="restoreEntry('${item.id}')">å¾©å…ƒ</button>
                <button class="btn-danger" onclick="permanentDelete('${item.id}')">å®Œå…¨å‰Šé™¤</button>
              `}
            </td>
          `;
          tbody.appendChild(row);
        });
      } catch (error) {
        console.error('ç®¡ç†ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
        alert('ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
      } finally {
        showLoading('adminLoading', false);
      }
    }

    // ===========================================
    // å‰Šé™¤ãƒ»å¾©å…ƒãƒ»å®Œå…¨å‰Šé™¤
    // ===========================================
    async function deleteEntry(id) {
      if (!confirm(`ID: ${id} ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿï¼ˆå¾©å…ƒå¯èƒ½ï¼‰`)) return;

      try {
        const response = await fetch(SCRIPT_URL, {
          method: 'POST',
          body: JSON.stringify({ action: 'delete', id: id })
        });

        const result = await response.json();
        if (result.success) {
          alert('å‰Šé™¤ã—ã¾ã—ãŸ');
          adminLoadAll();
        } else {
          alert('å‰Šé™¤ã«å¤±æ•—: ' + (result.error || 'ä¸æ˜'));
        }
      } catch (error) {
        alert('ã‚¨ãƒ©ãƒ¼: ' + error.message);
      }
    }

    async function restoreEntry(id) {
      if (!confirm(`ID: ${id} ã‚’å¾©å…ƒã—ã¾ã™ã‹?`)) return;

      try {
        const response = await fetch(SCRIPT_URL, {
          method: 'POST',
          body: JSON.stringify({ action: 'restore', id: id })
        });

        const result = await response.json();
        if (result.success) {
          alert('å¾©å…ƒã—ã¾ã—ãŸ');
          adminLoadAll();
        } else {
          alert('å¾©å…ƒã«å¤±æ•—: ' + (result.error || 'ä¸æ˜'));
        }
      } catch (error) {
        alert('ã‚¨ãƒ©ãƒ¼: ' + error.message);
      }
    }

    async function permanentDelete(id) {
      if (!confirm(`ID: ${id} ã‚’å®Œå…¨å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ï¼`)) return;

      try {
        const response = await fetch(SCRIPT_URL, {
          method: 'POST',
          body: JSON.stringify({ action: 'permanentDelete', id: id })
        });

        const result = await response.json();
        if (result.success) {
          alert('å®Œå…¨å‰Šé™¤ã—ã¾ã—ãŸ');
          adminLoadAll();
        } else {
          alert('å®Œå…¨å‰Šé™¤ã«å¤±æ•—: ' + (result.error || 'ä¸æ˜'));
        }
      } catch (error) {
        alert('ã‚¨ãƒ©ãƒ¼: ' + error.message);
      }
    }

    // ===========================================
    // ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
    // ===========================================
    function showMessage(elementId, message, type) {
      const msgDiv = document.getElementById(elementId);
      msgDiv.className = `message ${type}`;
      msgDiv.textContent = message;
      msgDiv.style.display = 'block';

      setTimeout(() => {
        msgDiv.style.display = 'none';
      }, 5000);
    }

    function hideMessage(elementId) {
      const msgDiv = document.getElementById(elementId);
      msgDiv.style.display = 'none';
    }

    function showLoading(elementId, show) {
      const loadingDiv = document.getElementById(elementId);
      if (show) {
        loadingDiv.classList.add('active');
      } else {
        loadingDiv.classList.remove('active');
      }
    }

    // ===========================================
    // åˆæœŸåŒ–
    // ===========================================
    window.addEventListener('DOMContentLoaded', function() {
      initPlayerCards();
      updateRankOptions();
    });
  </script>

</body>
</html>
